git init
git remote add origin https://github.com/NicoleNieto/dev_parcial2.git
git remote -v

dev_parcial2/
│
├── main.py
├── database.py
├── models.py
└── requirements.txt


python -m venv venv
venv\Scripts\activate

#pip install fastapi uvicorn sqlmodel

uvicorn main:app --reload
 
git add .
git commit -m "Primer commit del parcial"
git branch -M main
git push -u origin main

main
from fastapi import FastAPI, HTTPException, Depends
from sqlmodel import Session, select
from models import Usuario
from database import get_session, create_db

app = FastAPI(title="API de Usuarios")

# Crear DB al iniciar
@app.on_event("startup")
def on_startup():
    create_db()

# ---- POST: Crear usuario ----
@app.post("/usuarios/", response_model=Usuario)
def crear_usuario(usuario: Usuario, session: Session = Depends(get_session)):
    session.add(usuario)
    session.commit()
    session.refresh(usuario)
    return usuario

# ---- GET: Todos los usuarios ----
@app.get("/usuarios/", response_model=list[Usuario])
def listar_usuarios(session: Session = Depends(get_session)):
    return session.exec(select(Usuario)).all()

# ---- GET: Usuario por ID ----
@app.get("/usuarios/{usuario_id}", response_model=Usuario)
def obtener_usuario(usuario_id: int, session: Session = Depends(get_session)):
    usuario = session.get(Usuario, usuario_id)
    if not usuario:
        raise HTTPException(status_code=404, detail="Usuario no encontrado")
    return usuario

# ---- PUT: Actualizar usuario ----
@app.put("/usuarios/{usuario_id}", response_model=Usuario)
def actualizar_usuario(usuario_id: int, datos: Usuario, session: Session = Depends(get_session)):
    usuario = session.get(Usuario, usuario_id)
    if not usuario:
        raise HTTPException(status_code=404, detail="Usuario no encontrado")

    usuario.nombre = datos.nombre
    usuario.correo = datos.correo
    usuario.estado = datos.estado
    usuario.tipo = datos.tipo

    session.add(usuario)
    session.commit()
    session.refresh(usuario)
    return usuario

# ---- GET: Usuarios activos ----
@app.get("/usuarios/activos/", response_model=list[Usuario])
def usuarios_activos(session: Session = Depends(get_session)):
    return session.exec(select(Usuario).where(Usuario.estado == "Activo")).all()

# ---- GET: Usuarios premium y activos ----
@app.get("/usuarios/premium-activos/", response_model=list[Usuario])
def usuarios_premium_activos(session: Session = Depends(get_session)):
    return session.exec(
        select(Usuario).where((Usuario.estado == "Activo") & (Usuario.tipo == "Premium"))
    ).all()




models
from sqlmodel import SQLModel, Field
from typing import Optional

class Usuario(SQLModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    nombre: str
    correo: str
    estado: str  # "Activo" o "Inactivo"
    tipo: str    # "Premium" o "Normal"





database

from sqlmodel import SQLModel, create_engine, Session

sqlite_file_name = "database.db"
sqlite_url = f"sqlite:///{sqlite_file_name}"

engine = create_engine(sqlite_url, echo=True)

def get_session():
    with Session(engine) as session:
        yield session

def create_db():
    SQLModel.metadata.create_all(engine)
